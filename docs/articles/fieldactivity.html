<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fieldactivity">
<title>fieldactivity package for developers • fieldactivity</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="fieldactivity package for developers">
<meta property="og:description" content="fieldactivity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fieldactivity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/fieldactivity.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guide">Guide</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guide">
    <a class="dropdown-item" href="../guide/guideFieldactivity.html">User guide</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>fieldactivity package for developers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/fieldactivity/blob/HEAD/vignettes/fieldactivity.Rmd" class="external-link"><code>vignettes/fieldactivity.Rmd</code></a></small>
      <div class="d-none name"><code>fieldactivity.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="files-what-is-where">Files: what is where<a class="anchor" aria-label="anchor" href="#files-what-is-where"></a>
</h2>
<div class="section level3">
<h3 id="the-root-folder">The root folder<a class="anchor" aria-label="anchor" href="#the-root-folder"></a>
</h3>
<ul>
<li>
<code>DESCRIPTION</code>, <code>LICENCE</code>,
<code>NAMESPACE</code>, <code>LICENSE.md</code> are metadata files
related to R packages</li>
</ul>
</div>
<div class="section level3">
<h3 id="dev">
<code>dev</code><a class="anchor" aria-label="anchor" href="#dev"></a>
</h3>
<p>Contains files related to the development of the app.</p>
<p>You should create:</p>
<ul>
<li>a folder (e.g. <code>dev/dev_events</code>) for event files in the
development phase. Change the call to <code>run_app</code> in
<code>run_dev.R</code> to indicate the path to this folder</li>
<li>a user database (you can use <code>create_user_db.R</code> for
this). This too should be indicated in <code>run_dev.R</code>
</li>
</ul>
<p><code>01_start.R</code>, <code>02_dev.R</code> and
<code>03_deploy.R</code> contain useful commands related to app
development. These are files created by the Golem framework.
<code>02_dev.R</code> is the most useful of these, it can be used to
indicate dependencies to other packages, create new modules etc.</p>
<p>run_dev.R is the script that <code><a href="https://rdrr.io/pkg/golem/man/run_dev.html" class="external-link">golem::run_dev()</a></code> runs
(note, you should always use this command to run the app when developing
it). It sets up the app for running it while developing the app. Here
you can indicate whether you want the app to run in production or
development mode.</p>
</div>
<div class="section level3">
<h3 id="inst">
<code>inst</code><a class="anchor" aria-label="anchor" href="#inst"></a>
</h3>
<ul>
<li>
<code>golem-config.yml</code> is a configuration file related to
Golem. Note, don’t change the version number by hand here; see
<code>dev/02_dev.R</code> instead.</li>
<li>
<code>inst/app/www/script.js</code> is a javascript file the app
uses. It is added as a head tag to the app html. It is mostly related to
the table and fileInput modules.</li>
<li>
<code>inst/user_doc/inst_frontpage</code> is a file that the login
page will use to generate the text paragraphs.</li>
</ul>
<div class="section level4">
<h4 id="instextdata">
<code>inst/extdata</code><a class="anchor" aria-label="anchor" href="#instextdata"></a>
</h4>
<p>This folder is home to three important files.</p>
<div class="section level5">
<h5 id="ui_structure-json">
<code>ui_structure.json</code><a class="anchor" aria-label="anchor" href="#ui_structure-json"></a>
</h5>
<p>Contains the structure of each UI element. Each item in this file has
at least the following fields:</p>
<ul>
<li>
<code>code_name</code> is the name used to refer to the widget in
the app</li>
<li>
<code>type</code> is the type of the widget. This is one of the
following (listed under each type are the possible fields related to the
type):
<ul>
<li>
<code>selectInput</code>
<ul>
<li>
<code>choices</code>: a list of choices, a category in
<code>display_names.csv</code> or <code>"IGNORE"</code>. See the
documentation for the function <code>get_selectInput_choices</code>
defined in <code>fct_ui.R</code>.</li>
<li>
<code>multiple</code>: are multiple choices allowed? Defaults to
<code>false</code>.</li>
</ul>
</li>
<li>
<code>numericInput</code>
<ul>
<li>
<code>min</code>: The smallest acceptable value (inclusive)</li>
<li>
<code>max</code>: The largest acceptable value (inclusive)</li>
<li>
<code>step</code>: If set to 1, only integer values are allowed</li>
<li>
<code>sum_to</code>, <code>sum_of</code>: related to the calculation
of yield sums in <code>harvest_crop_table</code>
</li>
</ul>
</li>
<li>
<code>fileInput</code>
<ul>
<li>
<code>filetype</code>: The type of files that should be accepeted.
See Shiny documentation for the fileInput widget. This is not
necessarily enforced.</li>
</ul>
</li>
<li>
<code>textInput</code>
<ul>
<li>
<code>placeholder</code>: Code name of placeholder</li>
</ul>
</li>
<li>
<code>textAreaInput</code>
<ul>
<li>
<code>placeholder</code>: Code name of placeholder</li>
<li>
<code>maxlength</code>: The maximum acceptable length (in
characters) of the value</li>
</ul>
</li>
<li>
<code>textOutput</code>
<ul>
<li>
<code>dynamic</code>: If defined, indicates how the text should be
adjusted during the execution of app. See <code>form_title</code> for an
illustrative (and only) example.</li>
<li>
<code>style</code>: <code>"label"</code> if the text should look
like a widget label.</li>
</ul>
</li>
<li><code>actionButton</code></li>
<li><code>dateInput</code></li>
<li><code>dateRangeInput</code></li>
<li>
<code>dataTable</code>
<ul>
<li>
<code>columns</code>: The columns of the table in case it has a
dynamic row group</li>
<li>
<code>rows</code>: A list of row groups. There are two types of row
groups: dynamic and static. There can be at most one dynamic row group
and it comes first. There can be multiple static row groups. For dynamic
row groups the <code>row_variable</code> field indicates the widget
which determines the rows of the dynamic row group. For static rows the
variable names of the desired widgets are listed under
<code>variables</code> and <code>hide_labels</code> can be used to hide
the labels of these widgets (labels of the widgets in the dynamic row
group are automatically hidden). The name of a static row can be defined
in <code>name</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Other fields:</p>
<ul>
<li>
<code>label</code>: the code name of the label of the widget (this
will be found from <code>display_names.csv</code>)</li>
<li>
<code>required</code>: is it compulsory to fill the widget before
the event can be saved? Defaults to <code>false</code>.</li>
<li>
<code>hide_in_event_list</code>: should this variable be hidden in
the event list (when viewing a specific activity type)? Defaults to
<code>false</code>.</li>
<li>
<code>condition</code>: this isn’t specified for single widgets but
for groups of widgets. This is the condition (in javascript) which
determines whether the widget group in question should be visible or
not. This is given to a Shiny element called ConditionalPanel.</li>
</ul>
</div>
<div class="section level5">
<h5 id="display_names-csv">
<code>display_names.csv</code><a class="anchor" aria-label="anchor" href="#display_names-csv"></a>
</h5>
<p>A csv file with four columns: <code>category</code>,
<code>code_name</code>, <code>disp_name_eng</code> and
<code>disp_name_fin</code>. Each row is a translation of a code name
into the different languages. The category can be used to e.g. point a
set of these names as the choices of a selectInput widget.</p>
</div>
<div class="section level5">
<h5 id="fosites-csv">
<code>FOsites.csv</code><a class="anchor" aria-label="anchor" href="#fosites-csv"></a>
</h5>
<p>A csv file which contains the sites and their blocks. Note, the user
names in the user database should match the names of these sites exactly
(including case).</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="man-vignettes">
<code>man</code>, <code>vignettes</code><a class="anchor" aria-label="anchor" href="#man-vignettes"></a>
</h3>
<p><code>man</code> contains the function documentation generated by
Roxygen2, <code>vignettes</code> contains this vignette.</p>
</div>
<div class="section level3">
<h3 id="tests">
<code>tests</code><a class="anchor" aria-label="anchor" href="#tests"></a>
</h3>
<p>All tests should be placed under <code>tests/testthat</code>. The
testthat package is used. Currently automated test are made to check
that changing language works as expected, and that downloading buttons
return a valid file.</p>
</div>
<div class="section level3">
<h3 id="r">
<code>R</code><a class="anchor" aria-label="anchor" href="#r"></a>
</h3>
<p>This is the folder which contains the actual bulk of the application.
<code>run_app.R</code> defines the function which launches the app.
<code>app_server.R</code> and <code>app_ui.R</code> define the server
and UI functions of the main app. <code>fct_</code> and
<code>utils_</code> files contain helper functions. Files starting with
<code>mod_</code> are either modules or files directly related to
modules.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-structure-of-the-app">The structure of the app<a class="anchor" aria-label="anchor" href="#the-structure-of-the-app"></a>
</h2>
<p>The structure of the app can be summarised as follows:</p>
<ul>
<li>the main app consists of <code>app_server.R</code> and
<code>app_ui.R</code>. The UI includes (in order)
<ul>
<li>the language and site selectors</li>
<li>button to download the user instructions for the app</li>
<li>the title and introduction text</li>
<li>
<strong>the event list module</strong>
(<code>mod_event_list.R</code>)
<ul>
<li>the event list includes a table showing a list of events and
selectors to filter which events are displayed</li>
<li>buttons to download the events as a zipped json files or as a flat
csv</li>
</ul>
</li>
<li>buttons to create a new event and to clone an event</li>
<li>
<strong>the form module</strong> (<code>mod_form.R</code>)
<ul>
<li>this contains all the widgets for entering information about an
event and the save, cancel and delete event buttons</li>
<li>the default widgets (block, activity, date and description) are
hard-coded in the UI function of the module. The activity-specific
widgets are created by calling the <code>create_ui</code> function
(defined in <code>fct_ui.R</code>) in that same UI function.</li>
<li>the widgets include standard Shiny widgets as well as <strong>table
modules</strong> (<code>mod_table.R</code>) and <strong>fileInput
modules</strong> (<code>mod_fileInput.R</code>).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Modules are a tool to make Shiny apps more, well, modular. Each
module includes a UI function, which creates user interface components,
and a server function which defines how those components should
behave.</p>
<p>A module (more specifically, its server function) can be given input
values which are usually reactives (reactive is a Shiny term. Reactive
expressions can be thought of as functions which store their value and
only recalculate it when it is no longer valid.). For example, the
language chosen in the main app is passed on to other modules as a
reactive expression – when the language is changed by the user, that
reactive can be used to access the latest language in the modules.
Modules can also return values, and these values are usually reactive as
well. For example, the form module returns the values of widgets to the
main app server function, which goes on to edit or create a json file
based on this information.</p>
<div class="section level3">
<h3 id="the-startup-process">The startup process<a class="anchor" aria-label="anchor" href="#the-startup-process"></a>
</h3>
<p>A few words about the process of starting the app, as that became a
bit more complex recently. The app is started by a call to the
<code>run_app</code> function, defined in <code>R/run_app.R</code>. The
app can be started in two modes, production mode or developer mode. This
is controlled by the option <code>golem.app.prod</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>golem.app.prod <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># use production mode and hence user authentication</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>golem.app.prod <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># skip authentication</span></span>
<span><span class="co"># run_app(...)</span></span></code></pre></div>
<p>It is in this <code>run_app.R</code> file where the app is “wrapped
in shinymanager” to display the authentication UI if the app is in
production mode.</p>
<p>When the app starts, the <code>app_server</code> server function in
<code>R\app_server.R</code> is initialised. It is here that the event
list module server is initialised as well. However, calling the server
function of the form module is delayed until a site is specified (either
by logging in to a user account specific to a site or in admin mode
where the site selector is visible). This is done to decrease the time
it takes for the main app UI to be displayed. However, this causes a
small delay in the loading of events in the event list.</p>
<p>The form server is initialised by calling the function
<code>initialise_form</code> defined within the <code>app_server</code>
function. Furthermore, when the form server function is initialised, it
does not yet initialise the server function of table or fileInput
modules on the form. Instead, they are initialised the first time the
form is shown. Their initialisation happens by sending an initialisation
signal to the form through a reactive (<code>init_signal</code>), which
is being listened to by the form server function.</p>
</div>
</div>
<div class="section level2">
<h2 id="useful-resources">Useful resources<a class="anchor" aria-label="anchor" href="#useful-resources"></a>
</h2>
<ul>
<li>For Shiny: <a href="https://mastering-shiny.org" class="external-link">Mastering Shiny</a>
and <a href="https://shiny.rstudio.com/reference/shiny/" class="external-link">Shiny function
reference</a>
</li>
<li>For R packages: <a href="https://r-pkgs.org" class="external-link">R Packages</a> and <a href="https://kbroman.org/pkg_primer/" class="external-link">R package primer</a>
</li>
<li>For R: <a href="https://adv-r.hadley.nz" class="external-link">Advanced R</a>
</li>
<li>For Golem and Shiny app development: <a href="https://engineering-shiny.org" class="external-link">Engineering Production-Grade Shiny
Apps</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Henri Kajasilta, Otto Kuusela.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
